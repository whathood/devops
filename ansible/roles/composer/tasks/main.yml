---

- name: ensuring no other docker containers
  docker:
    name: wh_composer
    image: whathood/composer:latest
    state: absent
  sudo: yes

- name: installing vendor libraries
  command: docker run -ti -v /home/{{ user }}/.composer:/root/.composer -v {{ deploy_working_dir }}/app:/srv --name wh_composer whathood/composer install --no-interaction
  sudo: yes

- name: composer creates an autoload classmap
  command: sudo docker run -ti -v {{ deploy_working_dir }}/app:/srv whathood/composer dumpautoload -o
  when: application_env == 'production'
