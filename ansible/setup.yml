---

- hosts: all
  vars:
    user: "{{ ansible_ssh_user }}"
    log_dir: /var/log/whathood
  roles:
    - { role: common, sudo: yes }
    # Set up docker on the target machine
    - { role: virt_host_docker,
        sudo: yes,
        vars: { user: user },
        docker_group_members: [ user ]
      }

    - { role: vim, sudo: yes }

- include: git.yml

- hosts: all
  vars:
    user: "{{ ansible_ssh_user }}"
    log_dir: /var/log/whathood
  roles:
    - { role: rvm, sudo: yes }

    - { role: whathood_devops }

- include: prep_docker_env.yml

- include: deploy.yml

- include: import_db.yml
