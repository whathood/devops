#!/usr/bin/env ruby

provision_opt = ""

ARGV.each do|a|
  if a == "--provision"
    provision_opt = " " + a
  end
  puts "Argument: #{a}"
end

cmds = [
  "vagrant halt",

  # kill all running rsync-auto's
  "ps aux | grep rsync-auto | grep -v grep | awk '{ print $2 }' | xargs kill",

  "vagrant up#{provision_opt}",

  # pull the source back from the guest
  "vagrant rsync-back",

  # now auto rsync with out clearing the source dir
  "vagrant rsync-auto &",

  "cp provision/config/application_env whathood/src/"
]

cmds.each { |cmd|
  puts cmd
  unless system(cmd)
    abort "could not execute command: '#{cmd}'"
  end
}
