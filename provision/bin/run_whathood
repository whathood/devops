#!/usr/bin/env ruby

# Build the docker containers required by Whathood from whathood-devops

home = ENV['HOME']
user = ENV['USER']

puts "*      cloning whathood devops"

cmds = [
  # required for when adding a mapped drive from vagrant
  "echo \"whoami is: \" `whoami`",
  "echo \"home is: \" #{home}",
  "sudo chmod 777 #{home}/src",
  "git clone https://github.com/whathood/wh-devops.git #{home}/src/wh-devops || true",
  "git checkout -b develop",
  "cp /vagrant/provision/config/config.local.yaml #{home}/src/wh-devops"
]

cmds.each {|cmd|
  puts cmd
  unless system(cmd)
    abort "could not execute cmd '#{cmd}'"
  end
}

Dir.chdir "#{home}/src/wh-devops"

cmd = "sudo ./bin/setup"
puts cmd
system cmd
